<!DOCTYPE html>
<html>
<head>
  <title>User Formatter Modern UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
        --sidebar-bg: #1e293b;
        --sidebar-text: #e2e8f0;
        --accent-color: #3b82f6; /* Modern Blue */
        --accent-hover: #2563eb;
        --bg-color: #f1f5f9;
        --card-bg: #ffffff;
        --text-main: #334155;
    }

    body { 
        font-family: 'Inter', sans-serif; 
        margin: 0; 
        display: flex; 
        height: 100vh; 
        background-color: var(--bg-color); 
        color: var(--text-main);
    }
    
    /* --- SIDEBAR STYLING --- */
    .sidebar {
      width: 280px; 
      background: var(--sidebar-bg); 
      color: var(--sidebar-text); 
      display: flex;
      flex-direction: column;
      padding: 20px;
      overflow-y: auto;
      flex-shrink: 0;
      box-shadow: 4px 0 10px rgba(0,0,0,0.05);
    }
    
    .logo-area {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        text-align: center;
    }

    .logo-area h3 { 
      color: #fff; 
      margin: 0; 
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    /* Boxed Menu Items */
    .nav-links {
        display: flex;
        flex-direction: column;
        gap: 8px; /* Space between boxes */
    }

    .sidebar a {
      display: flex;
      align-items: center;
      color: #94a3b8; 
      text-decoration: none; 
      padding: 12px 16px; 
      font-size: 14px;
      font-weight: 500;
      background: rgba(255,255,255,0.03); /* Subtle background */
      border-radius: 8px; /* Rounded corners */
      border: 1px solid transparent;
      transition: all 0.2s ease;
    }

    /* Hover State */
    .sidebar a:hover { 
      background: rgba(255,255,255,0.1);
      color: #fff;
      transform: translateX(3px); /* Slight movement */
    }

    /* Active State (Selected Project) */
    .sidebar a.active {
      background: var(--accent-color);
      color: #fff;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); /* Glow effect */
      font-weight: 600;
      border: 1px solid rgba(255,255,255,0.1);
    }

    /* Icon placeholder (optional) */
    .sidebar a::before {
        content: '';
        display: inline-block;
        width: 8px;
        height: 8px;
        background-color: currentColor;
        border-radius: 50%;
        margin-right: 12px;
        opacity: 0.5;
    }
    .sidebar a.active::before { opacity: 1; background-color: #fff; }

    /* --- MAIN CONTENT --- */
    .content { 
        flex: 1; 
        padding: 40px; 
        overflow-y: auto; 
    }

    .card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        max-width: 900px;
        margin: 0 auto;
    }

    h2 { 
        margin-top: 0; 
        color: var(--text-main); 
        font-size: 1.5rem;
        border-bottom: 2px solid #f1f5f9; 
        padding-bottom: 15px; 
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .status-badge {
        font-size: 0.8rem;
        padding: 4px 12px;
        border-radius: 20px;
        font-weight: 600;
    }

    .status-active {
        background: #dcfce7;
        color: #166534;
    }
    
    .status-inactive {
        background: #ffe4e6; /* Light Red */
        color: #be123c; /* Dark Red */
    }

    /* Container i Formës dhe Output-it - e fshehim në rast se projekti nuk është aktiv */
    #formatterContainer {
        transition: opacity 0.3s ease;
    }

    #inactiveMessage {
        padding: 30px;
        border: 2px solid #fca5a5;
        background: #fee2e2;
        color: #dc2626;
        border-radius: 8px;
        text-align: center;
        font-size: 1.2rem;
        font-weight: 600;
        margin-top: 25px;
        display: none; /* Fshehur fillimisht */
    }


    textarea { 
        width: 100%; 
        height: 120px; 
        padding: 15px; 
        background: #f8fafc;
        border: 2px solid #e2e8f0; 
        border-radius: 8px; 
        font-family: 'Courier New', monospace; 
        font-size: 14px;
        color: #334155;
        resize: vertical;
        box-sizing: border-box;
        transition: border-color 0.2s;
    }
    
    textarea:focus { 
        border-color: var(--accent-color); 
        outline: none; 
        background: #fff;
    }

    .action-bar {
        margin-top: 15px;
        display: flex;
        justify-content: flex-end;
    }

    button { 
      padding: 10px 24px; 
      background: var(--accent-color); 
      color: white; 
      border: none; 
      border-radius: 6px; 
      cursor: pointer; 
      font-size: 15px; 
      font-weight: 600;
      transition: background 0.2s, transform 0.1s;
      box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
    }
    button:hover { background: var(--accent-hover); transform: translateY(-1px); }
    button:active { transform: translateY(0); }

    /* Output Area */
    .output-container {
        margin-top: 30px;
        background: #1e293b; /* Dark terminal style */
        border-radius: 8px;
        overflow: hidden;
    }

    .output-header {
        background: #0f172a;
        padding: 8px 15px;
        color: #94a3b8;
        font-size: 0.8rem;
        border-bottom: 1px solid #334155;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .output-content {
        padding: 20px;
        color: #e2e8f0;
        font-family: 'Courier New', monospace;
        white-space: pre-wrap;
        font-size: 14px;
        line-height: 1.5;
        min-height: 150px; /* Shtohet lartësia minimale për të shfaqur rezultatin */
        overflow-x: auto;
    }

    .download-btn {
        background: #10b981; /* Green */
        box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
        margin-left: 10px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 38px; /* match button height */
        padding: 0 20px;
        border-radius: 6px;
        color: white;
        font-size: 15px;
        font-weight: 600;
    }
    .download-btn:hover { background: #059669; }

    .helper-text { font-size: 0.9rem; color: #64748b; margin-bottom: 8px; }
    
    .error-message {
        color: #dc2626; /* Red */
        background: #fee2e2;
        padding: 10px;
        border-radius: 6px;
        margin-bottom: 15px;
        border: 1px solid #fca5a5;
        font-weight: 500;
        display: none; /* Fshehur si fillim */
    }

  </style>
</head>
<body>

  <!-- Sidebar Modern -->
  <div class="sidebar">
    <div class="logo-area">
        <h3>Project Manager</h3>
    </div>
    
    <div class="nav-links">
        <!-- IPSOS Active Example -->
        <a href="#" data-project="ipsos" class="link-ipsos">Ipsos</a>
        <a href="#" data-project="usuma" class="link-usuma">Usuma</a>
        <a href="#" data-project="abh" class="link-abh active">ABH</a> <!-- ABH aktiv tani -->
        <a href="#" data-project="leyhausen" class="link-leyhausen">Leyhausen</a>
        <a href="#" data-project="imug" class="link-imug">Imug</a>
        <a href="#" data-project="imfield" class="link-imfield">ImField</a>
        <a href="#" data-project="kraemer" class="link-kraemer">Krämer</a>
        <a href="#" data-project="ingress" class="link-ingress">Ingress</a>
        <a href="#" data-project="immler" class="link-immler">Immler</a>
        <a href="#" data-project="salesupplay" class="link-salesupplay">Salesupplay</a>
        <a href="#" data-project="kantar-de" class="link-kantar-de">Kantar DE</a>
        <a href="#" data-project="tns" class="link-tns">TNS User</a>
        <a href="#" data-project="kantar-forsta" class="link-kantar-forsta">Kantar AU + Forsta</a>
        <a href="#" data-project="kantar-au" class="link-kantar-au">Kantar AU</a>
        <a href="#" data-project="otto" class="link-otto">OTTO</a>
    </div>
  </div>

  <div class="content">
    <div class="card">
        <h2 id="projectTitle">
            ABH Formatter
            <span id="projectStatus" class="status-badge status-active">Aktiv</span>
        </h2>
        
        <!-- Mesazhi për projektet joaktive -->
        <div id="inactiveMessage" style="display: none;">
            Ky projekt nuk është aktiv. Konvertimi i të dhënave nuk është i mundur.
        </div>

        <div id="formatterContainer">
            <div id="errorMessage" class="error-message"></div>

            <p id="helperText" class="helper-text">Ngjisni stringun e përdoruesit të ndarë me TAB këtu.</p>
            
            <form onsubmit="return false;">
                <textarea id="dataInput" placeholder="Emine Ibishi	Agent_Bambus16	Bambus16	935912	E4}s4%L1|"></textarea>
                <div class="action-bar">
                    <button type="button" onclick="handleConvert()">Konverto Të Dhënat</button>
                </div>
            </form>

            <!-- Output Visualization -->
            <div class="output-container">
                <div class="output-header">
                    <span>REZULTATI I GJENERUAR</span>
                    <span style="font-size: 10px; opacity: 0.7;">FORMATI TXT</span>
                </div>
                <div id="outputContent" class="output-content">Duke pritur për të dhëna...</div>
            </div>

            <div style="margin-top: 20px; text-align: right;">
                <a href="#" id="downloadBtn" class="download-btn" onclick="downloadTxt()" style="display: none;">Shkarko .txt</a>
            </div>
        </div>
    </div>
  </div>

<script>
    // Mbajtësi i statusit të projektit aktual. Fillojmë me ABH siç u kërkua.
    let currentProject = 'abh';
    const ACTIVE_PROJECTS = {
        'ipsos': {
            fieldsCount: 11,
            helper: "Ngjisni stringun e përdoruesit të ndarë me TAB këtu (p.sh., 11 fusha: VPN_User, VPN_Pass, 2FA_Email, etj.):",
            placeholder: "10902.ips.de.intvwr\tp?2C4m0u1l\tbambus.8@bambusacademy.com\tbambus.8.ipsos\tipsos10902\t#Ipsos10902TT\tdeaw3e7457\t7457\tCae5reekixeey0uw\tGermany\tJan Steen",
            converter: formatIpsos,
            fileNamePrefix: '_data',
        },
        'abh': {
            fieldsCount: 5,
            helper: "Ngjisni stringun e përdoruesit të ndarë me TAB këtu (5 fusha: Emri, ABH_User, ABH_Pass, IAX_Ext, IAX_Pass):",
            placeholder: "Emine Ibishi\tAgent_Bambus16\tBambus16\t935912\tE4}s4%L1|",
            converter: formatABH,
            fileNamePrefix: '',
        }
        // Projektet e tjera do të përdorin mesazhin joaktiv
    };

    // --- LOGJIKA E KONVERTIMIT SPECIFIK ---

    // 1. Funksioni për formatimin e të dhënave të Ipsos (11 fusha)
    function formatIpsos(fields) {
        if (fields.length < 11) {
            return `ERROR: Numri i fushave të ndara me TAB është i pasaktë. Priten të paktën 11, u gjetën ${fields.length}.`;
        }

        const vpnUser = fields[0]; 
        const vpnPass = fields[1]; 
        const twoFaEmail = fields[2]; 
        const ingressUser = fields[3]; 
        const ingressPass = fields[4]; 
        const webMailPass = fields[5]; 
        const webMail2FaPass = fields[6]; 
        const sipUser = fields[7]; 
        const sipPass = fields[8]; 
        // fields[9] është Shteti (Germany)
        const name = fields[10];

        const output = 
`Name: ${name}

----VPN----
User: ${vpnUser}
Pass: ${vpnPass}
2FA e-Mail: ${twoFaEmail}

----Ingress----
User: ${ingressUser}
Pass: ${ingressPass}

----SIP(Xlite)----
User Name: ${sipUser}
Password: ${sipPass}
Soft Phone Domain IP: 172.16.12.8

----WebMail----
2FA e-Mail: ${twoFaEmail}
Password: ${webMailPass}@
WebMail login page: https://sxb1plzcpnl489552.prod.sxb1.secureserver.net:2096/

----Ingress Interview login page----
EMA Server Link: https://d534ema.keyingress.de/
EMA 2FA VPN: emeavpn01.ipsos.com/2fa`;

        return output;
    }

    // 2. Funksioni për formatimin e të dhënave të ABH (5 fusha)
    function formatABH(fields) {
        // Shqyrto numrin e fushave
        if (fields.length !== 5) {
            return `ERROR: Numri i fushave të ndara me TAB është i pasaktë. Priten saktësisht 5 fusha, u gjetën ${fields.length}.`;
        }

        const name = fields[0]; // Emine Ibishi
        const abhUser = fields[1]; // Agent_Bambus16
        const abhPass = fields[2]; // Bambus16
        const iaxExt = fields[3]; // 935912
        const iaxPass = fields[4]; // E4}s4%L1|

        // Outputi sipas formatit të kërkuar (ABH Emine Ibishi.txt - Notepad)
        const output = 
`Name:  ${name}

--------------------------------------
ABH Login Details
Username:  ${abhUser}
Password:  ${abhPass}
--------------------------------------
IAX Extension:  ${iaxExt}
Password:  ${iaxPass}
ABH Domain: eu.sip.ssl17.net`;
        
        return output;
    }

    // --- LOGJIKA KRYESORE E APLIKACIONIT ---

    // Funksioni për menaxhimin e konvertimit
    function handleConvert() {
        const projectConfig = ACTIVE_PROJECTS[currentProject];

        if (!projectConfig) {
            // Sigurohuni që mos të bëhet konvertimi nëse projekti nuk është aktiv
            return;
        }

        const inputElement = document.getElementById('dataInput');
        const outputElement = document.getElementById('outputContent');
        const errorElement = document.getElementById('errorMessage');
        const downloadBtn = document.getElementById('downloadBtn');

        const rawInput = inputElement.value.trim();
        
        // Përpiqemi të ndajmë të dhënat me TAB
        let fields = rawInput.split('\t');
        let isValidSplit = true;

        // Përpiqemi të rregullojmë nëse inputi përdor hapësira në vend të TAB-ave për ndarje
        if (fields.length < projectConfig.fieldsCount) {
            // Për ABH (5 fusha) dhe IPSOS (11 fusha)
            // Kërkojmë për 4 (ABH) ose 10 (IPSOS) ndarës me hapsirë/tab, dhe pjesa e mbetur është fusha e fundit
            // Kjo është një qasje e përgjithshme, por ndarja me TAB është e preferuar
            const regexPattern = `^([^\t\\s]+[\\t\\s]+){${projectConfig.fieldsCount - 1}}([^\t\\s]+)$`;
            const spaceSplitRegex = new RegExp(regexPattern);
            const fieldsFromSpaceMatch = rawInput.match(spaceSplitRegex);

            if (fieldsFromSpaceMatch && fieldsFromSpaceMatch.length === projectConfig.fieldsCount + 1) {
                 // Nxjerrim vetëm grupet e kapura (fushën e 1-rë deri të fushën e fundit)
                 fields = fieldsFromSpaceMatch.slice(1, projectConfig.fieldsCount + 1).map(f => f.trim());
                 isValidSplit = true;
            } else if (fields.length === projectConfig.fieldsCount) {
                // Rasti kur ndarja me TAB ishte ok, por fillimisht fields.length < fieldsCount doli false gabimisht (sigurim)
                isValidSplit = true;
            } else {
                isValidSplit = false;
            }
        }
        
        // Finalizimi i fushave
        const finalFields = fields.map(f => f.trim());

        if (finalFields.length !== projectConfig.fieldsCount) {
             errorElement.innerHTML = `Gabim: Duhet të ngjisni saktësisht ${projectConfig.fieldsCount} fusha të ndara me TAB (ose hapësirë). U gjetën ${finalFields.length}.`;
             errorElement.style.display = 'block';
             outputElement.innerText = "Error during conversion. Please check input format.";
             downloadBtn.style.display = 'none';
             return;
        }

        // Procesimi i Konvertimit
        errorElement.style.display = 'none';
        try {
            const formattedData = projectConfig.converter(finalFields);
            
            if (formattedData.startsWith("ERROR")) {
                errorElement.innerHTML = formattedData.replace("ERROR: ", "");
                errorElement.style.display = 'block';
                outputElement.innerText = "Error during conversion. Please check input format.";
                downloadBtn.style.display = 'none';
            } else {
                outputElement.innerText = formattedData;
                downloadBtn.style.display = 'inline-flex';
            }

        } catch (e) {
            errorElement.innerHTML = "Një gabim i papritur ndodhi gjatë formatimit: " + e.message;
            errorElement.style.display = 'block';
            outputElement.innerText = "Internal error.";
            downloadBtn.style.display = 'none';
        }
    }

    // Funksioni për shkarkimin e skedarit TXT
    function downloadTxt() {
        const outputContent = document.getElementById('outputContent').innerText;
        const projectConfig = ACTIVE_PROJECTS[currentProject] || { fileNamePrefix: '_data' };
        
        // Përpiqet të gjejë emrin nga rreshti 'Name:'
        const nameMatch = outputContent.match(/Name:\s+(.*)\n/);
        const defaultName = 'formatted_user';
        let baseName = (nameMatch && nameMatch[1].trim()) ? nameMatch[1].trim().replace(/\s/g, '_') : defaultName;

        // Shton prefiksin e skedarit (p.sh. '_data' për Ipsos, ose asgjë për ABH)
        const fileName = `${baseName}${projectConfig.fileNamePrefix}.txt`;
        
        // Krijimi i Blob dhe linku i shkarkimit
        const blob = new Blob([outputContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url); // Pastron URL-në e krijuar
    }

    // Funksioni për menaxhimin e klikimeve në sidebar
    function handleProjectSwitch(event) {
        event.preventDefault();
        const targetLink = event.currentTarget;
        const projectId = targetLink.getAttribute('data-project');
        
        const links = document.querySelectorAll('.sidebar a');
        links.forEach(link => link.classList.remove('active'));
        targetLink.classList.add('active');

        currentProject = projectId;
        updateMainContent(projectId);
    }

    // Funksioni për të përditësuar pamjen kryesore bazuar në projektin e zgjedhur
    function updateMainContent(projectId) {
        const titleElement = document.getElementById('projectTitle');
        const statusBadge = document.getElementById('projectStatus');
        const formatterContainer = document.getElementById('formatterContainer');
        const inactiveMessage = document.getElementById('inactiveMessage');
        const dataInput = document.getElementById('dataInput');
        const helperText = document.getElementById('helperText');
        const outputContent = document.getElementById('outputContent');
        const errorElement = document.getElementById('errorMessage');

        const projectName = document.querySelector(`.sidebar a[data-project="${projectId}"]`).textContent;

        titleElement.innerHTML = `${projectName} Formatter <span id="projectStatus" class="status-badge"></span>`;
        const newStatusBadge = document.getElementById('projectStatus');
        
        const projectConfig = ACTIVE_PROJECTS[projectId];

        if (projectConfig) {
            // Projekti është AKTIV
            newStatusBadge.textContent = 'Aktiv';
            newStatusBadge.classList.remove('status-inactive');
            newStatusBadge.classList.add('status-active');
            
            formatterContainer.style.display = 'block';
            inactiveMessage.style.display = 'none';

            // Përditëson inputin dhe ndihmën
            helperText.textContent = projectConfig.helper;
            dataInput.placeholder = projectConfig.placeholder;
            dataInput.value = projectConfig.placeholder;
            outputContent.innerText = "Duke pritur për të dhëna...";
            errorElement.style.display = 'none';
            
            // Konverton të dhënat e shembullit
            handleConvert();

        } else {
            // Projektet e tjera janë JOAKTIVE
            newStatusBadge.textContent = 'Joaktiv';
            newStatusBadge.classList.remove('status-active');
            newStatusBadge.classList.add('status-inactive');
            
            formatterContainer.style.display = 'none';
            inactiveMessage.style.display = 'block';
        }
    }


    // Vendosja e përmbajtjes fillestare dhe dëgjuesit e ngjarjeve
    document.addEventListener('DOMContentLoaded', () => {
        // Krijon dëgjuesit e ngjarjeve për klikimet e sidebar
        const links = document.querySelectorAll('.sidebar a');
        links.forEach(link => {
            link.addEventListener('click', handleProjectSwitch);
        });

        // Kujdes: Thërret logjikën e përditësimit me projektin fillestar 'abh'
        updateMainContent('abh');
    });

</script>

</body>
</html>
