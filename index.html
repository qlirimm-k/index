<!DOCTYPE html>
<html>
<head>
  <title>User Formatter Modern UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght=400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
        --sidebar-bg: #1e293b;
        --sidebar-text: #e2e8f0;
        --accent-color: #3b82f6; /* Modern Blue */
        --accent-hover: #2563eb;
        --bg-color: #f1f5f9;
        --card-bg: #ffffff;
        --text-main: #334155;
    }

    body { 
        font-family: 'Inter', sans-serif; 
        margin: 0; 
        display: flex; 
        height: 100vh; 
        background-color: var(--bg-color); 
        color: var(--text-main);
    }
    
    /* Global Container Setup (to handle login screen) */
    #appContainer {
        display: flex;
        width: 100%;
        height: 100%;
        transition: opacity 0.3s ease;
    }

    /* --- LOGIN SCREEN STYLING --- */
    #loginScreen {
        display: none; /* Controlled by JS */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--bg-color);
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }

    .login-card {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 40px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 400px;
        text-align: center;
    }

    .login-card h3 {
        color: var(--accent-color);
        margin-bottom: 30px;
        font-weight: 700;
        font-size: 1.8rem;
    }

    .login-group {
        margin-bottom: 20px;
        text-align: left;
    }

    .login-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--text-main);
        font-size: 0.9rem;
    }

    .login-group input {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        box-sizing: border-box;
        font-size: 1rem;
        transition: border-color 0.2s;
    }
    
    .login-group input:focus {
        border-color: var(--accent-color);
        outline: none;
    }

    #loginError {
        color: #dc2626;
        background: #fee2e2;
        padding: 10px;
        border-radius: 6px;
        margin-bottom: 15px;
        display: none;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .login-button {
        width: 100%;
        margin-top: 10px;
        font-size: 1.1rem;
    }
    
    /* --- SIDEBAR STYLING --- */
    .sidebar {
      width: 280px; 
      background: var(--sidebar-bg); 
      color: var(--sidebar-text); 
      display: flex;
      flex-direction: column;
      padding: 20px;
      overflow-y: auto;
      flex-shrink: 0;
      box-shadow: 4px 0 10px rgba(0,0,0,0.05);
    }
    
    .logo-area {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        text-align: center;
    }

    .logo-area h3 { 
      color: #fff; 
      margin: 0; 
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    /* Boxed Menu Items */
    .nav-links {
        display: flex;
        flex-direction: column;
        gap: 8px; /* Space between boxes */
    }

    .sidebar a {
      display: flex;
      align-items: center;
      color: #94a3b8; 
      text-decoration: none; 
      padding: 12px 16px; 
      font-size: 14px;
      font-weight: 500;
      background: rgba(255,255,255,0.03); /* Subtle background */
      border-radius: 8px; /* Rounded corners */
      border: 1px solid transparent;
      transition: all 0.2s ease;
    }

    /* Hover State */
    .sidebar a:hover { 
      background: rgba(255,255,255,0.1);
      color: #fff;
      transform: translateX(3px); /* Slight movement */
    }

    /* Active State (Selected Project) */
    .sidebar a.active {
      background: var(--accent-color);
      color: #fff;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); /* Glow effect */
      font-weight: 600;
      border: 1px solid rgba(255,255,255,0.1);
    }

    /* Icon placeholder (optional) */
    .sidebar a::before {
        content: '';
        display: inline-block;
        width: 8px;
        height: 8px;
        background-color: currentColor;
        border-radius: 50%;
        margin-right: 12px;
        opacity: 0.5;
    }
    .sidebar a.active::before { opacity: 1; background-color: #fff; }

    /* --- MAIN CONTENT --- */
    .content { 
        flex: 1; 
        padding: 40px; 
        overflow-y: auto; 
    }

    .card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        max-width: 900px;
        margin: 0 auto;
    }

    h2 { 
        margin-top: 0; 
        color: var(--text-main); 
        font-size: 1.5rem;
        border-bottom: 2px solid #f1f5f9; 
        padding-bottom: 15px; 
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .status-badge {
        font-size: 0.8rem;
        padding: 4px 12px;
        border-radius: 20px;
        font-weight: 600;
    }

    .status-active {
        background: #dcfce7;
        color: #166534;
    }
    
    .status-inactive {
        background: #ffe4e6; /* Light Red */
        color: #be123c; /* Dark Red */
    }

    /* Container i Formës dhe Output-it - e fshehim në rast se projekti nuk është aktiv */
    #formatterContainer {
        transition: opacity 0.3s ease;
    }

    #inactiveMessage {
        padding: 30px;
        border: 2px solid #fca5a5;
        background: #fee2e2;
        color: #dc2626;
        border-radius: 8px;
        text-align: center;
        font-size: 1.2rem;
        font-weight: 600;
        margin-top: 25px;
        display: none; /* Fshehur fillimisht */
    }


    textarea { 
        width: 100%; 
        height: 120px; 
        padding: 15px; 
        background: #f8fafc;
        border: 2px solid #e2e8f0; 
        border-radius: 8px; 
        font-family: 'Courier New', monospace; 
        font-size: 14px;
        color: #334155;
        resize: vertical;
        box-sizing: border-box;
        transition: border-color 0.2s;
        /* Kjo ndihmon të duket stringu i ndarë me TAB siç duhet */
        white-space: pre-wrap; 
        line-height: 1.8;
    }
    
    textarea:focus { 
        border-color: var(--accent-color); 
        outline: none; 
        background: #fff;
    }

    .action-bar {
        margin-top: 15px;
        display: flex;
        justify-content: flex-end;
    }

    button { 
      padding: 10px 24px; 
      background: var(--accent-color); 
      color: white; 
      border: none; 
      border-radius: 6px; 
      cursor: pointer; 
      font-size: 15px; 
      font-weight: 600;
      transition: background 0.2s, transform 0.1s;
      box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
    }
    button:hover { background: var(--accent-hover); transform: translateY(-1px); }
    button:active { transform: translateY(0); }

    /* Output Area */
    .output-container {
        margin-top: 30px;
        background: #1e293b; /* Dark terminal style */
        border-radius: 8px;
        overflow: hidden;
    }

    .output-header {
        background: #0f172a;
        padding: 8px 15px;
        color: #94a3b8;
        font-size: 0.8rem;
        border-bottom: 1px solid #334155;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .output-content {
        padding: 20px;
        color: #e2e8f0;
        font-family: 'Courier New', monospace;
        white-space: pre-wrap;
        font-size: 14px;
        line-height: 1.5;
        min-height: 150px; /* Shtohet lartësia minimale për të shfaqur rezultatin */
        overflow-x: auto;
    }

    .download-btn {
        background: #10b981; /* Green */
        box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
        margin-left: 10px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 38px; /* match button height */
        padding: 0 20px;
        border-radius: 6px;
        color: white;
        font-size: 15px;
        font-weight: 600;
    }
    .download-btn:hover { background: #059669; }

    .helper-text { font-size: 0.9rem; color: #64748b; margin-bottom: 8px; }
    
    .error-message {
        color: #dc2626; /* Red */
        background: #fee2e2;
        padding: 10px;
        border-radius: 6px;
        margin-bottom: 15px;
        border: 1px solid #fca5a5;
        font-weight: 500;
        display: none; /* Fshehur si fillim */
    }

  </style>
</head>
<body>

  <!-- 1. Faqja e Hyrjes (Login) -->
  <div id="loginScreen">
    <div class="login-card">
        <h3>Hyrja në Panelin e Kontrollit</h3>
        
        <div id="loginError"></div>

        <form id="loginForm" onsubmit="handleLogin(event)">
            <div class="login-group">
                <label for="username">Përdoruesi (Username):</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="login-group">
                <label for="password">Fjalëkalimi (Password):</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit" class="login-button">Hyr</button>
        </form>
    </div>
  </div>


  <!-- 2. Kontenieri i Dashboard-it -->
  <div id="appContainer" style="display: none;">
    <!-- Sidebar Modern (Vetëm projektet e kërkuara) -->
    <div class="sidebar">
        <div class="logo-area">
            <h3>Project Manager</h3>
        </div>
        
        <div class="nav-links">
            <a href="#" data-project="ipsos" class="link-ipsos">Ipsos</a>
            <a href="#" data-project="usuma" class="link-usuma">Usuma</a>
            <a href="#" data-project="abh" class="link-abh active">ABH</a> 
            <a href="#" data-project="leyhausen" class="link-leyhausen">Leyhausen</a>
        </div>
    </div>

    <div class="content">
        <div class="card">
            <h2 id="projectTitle">
                ABH Formatter
                <span id="projectStatus" class="status-badge status-active">Aktiv</span>
            </h2>
            
            <!-- Mesazhi për projektet joaktive -->
            <div id="inactiveMessage" style="display: none;">
                Ky projekt nuk është aktiv. Konvertimi i të dhënave nuk është i mundur.
            </div>

            <div id="formatterContainer">
                <div id="errorMessage" class="error-message"></div>

                <p id="helperText" class="helper-text">Ngjisni stringun e përdoruesit të ndarë me TAB këtu.</p>
                
                <form onsubmit="return false;">
                    <textarea id="dataInput" placeholder="Emine Ibishi	Agent_Bambus16	Bambus16	935912	E4}s4%L1|"></textarea>
                    <div class="action-bar">
                        <button type="button" onclick="handleConvert()">Konverto Të Dhënat</button>
                    </div>
                </form>

                <!-- Output Visualization -->
                <div class="output-container">
                    <div class="output-header">
                        <span>REZULTATI I GJENERUAR</span>
                        <span style="font-size: 10px; opacity: 0.7;">FORMATI TXT</span>
                    </div>
                    <div id="outputContent" class="output-content">Duke pritur për të dhëna...</div>
                </div>

                <div style="margin-top: 20px; text-align: right;">
                    <a href="#" id="downloadBtn" class="download-btn" onclick="downloadTxt()" style="display: none;">Shkarko .txt</a>
                </div>
            </div>
        </div>
    </div>
  </div>

<script>
    let currentProject = 'abh';
    // Authentication constants
    const AUTH_KEY = 'formatter_auth_token';
    const VALID_USER = 'admin';
    const VALID_PASS = 'bukibuki'; // New requested password

    // --- AUTHENTICATION LOGIC ---

    // Function to save the token (using Cookie for simplicity)
    function setAuthToken(token) {
        // Set cookie to expire in 7 days
        document.cookie = `${AUTH_KEY}=${token}; max-age=${60 * 60 * 24 * 7}; path=/`; 
    }

    // Function to get the token
    function getAuthToken() {
        const name = AUTH_KEY + "=";
        const decodedCookie = decodeURIComponent(document.cookie);
        const ca = decodedCookie.split(';');
        for(let i = 0; i <ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) === 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    // Login handler function
    function handleLogin(event) {
        event.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const errorElement = document.getElementById('loginError');

        if (username === VALID_USER && password === VALID_PASS) {
            // Successful login
            setAuthToken('logged_in_true');
            showDashboard();
        } else {
            // Failed login
            errorElement.textContent = "Përdoruesi ose fjalëkalimi është i pasaktë.";
            errorElement.style.display = 'block';
        }
    }

    // Function to show the Dashboard and hide the Login Form
    function showDashboard() {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('appContainer').style.display = 'flex';
        // Initialize dashboard state
        initializeDashboard(); 
    }

    // Function to show the Login Form and hide the Dashboard
    function showLogin() {
        document.getElementById('loginScreen').style.display = 'flex';
        document.getElementById('appContainer').style.display = 'none';
    }


    // --- PROJECT CONFIGURATION AND MAIN APPLICATION LOGIC ---

    // Project configuration. Only Ipsos and ABH are Active (have 'converter').
    const PROJECTS_CONFIG = {
        'ipsos': {
            fieldsCount: 11,
            helper: "Ngjisni stringun e përdoruesit të ndarë me TAB këtu (11 fusha: VPN_User, VPN_Pass, 2FA_Email, Ingress_User, Ingress_Pass, WebMail_Pass, WebMail_2FA_Pass, SIP_User, SIP_Pass, Shteti, Emri):",
            placeholder: "10902.ips.de.intvwr\tp?2C4m0u1l\tbambus.8@bambusacademy.com\tbambus.8.ipsos\tipsos10902\t#Ipsos10902TT\tdeaw3e7457\t7457\tCae5reekixeey0uw\tGermany\tJan Steen",
            converter: formatIpsos, // Active
            fileNamePrefix: '_data',
        },
        'abh': {
            fieldsCount: 5,
            helper: "Ngjisni stringun e përdoruesit të ndarë me TAB këtu (5 fusha: Emri, ABH_User, ABH_Pass, IAX_Ext, IAX_Pass):",
            placeholder: "Emine Ibishi\tAgent_Bambus16\tBambus16\t935912\tE4}s4%L1|",
            converter: formatABH, // Active
            fileNamePrefix: '',
        },
        'usuma': {
            fieldsCount: 7,
            helper: "Ky projekt nuk është aktiv. Konvertimi i të dhënave nuk është i mundur.",
            placeholder: "Ky projekt nuk është aktiv.",
            converter: null, // Inactive
            fileNamePrefix: '_usuma_data',
        },
        'leyhausen': {
            fieldsCount: 6,
            helper: "Ky projekt nuk është aktiv. Konvertimi i të dhënave nuk është i mundur.",
            placeholder: "Ky projekt nuk është aktiv.",
            converter: null, // Inactive
            fileNamePrefix: '_leyhausen_user',
        },
    };


    // 1. Ipsos data formatting function (11 fields)
    function formatIpsos(fields) {
        if (fields.length !== 11) {
            return `ERROR: Numri i fushave të ndara me TAB është i pasaktë. Priten saktësisht 11, u gjetën ${fields.length}.`;
        }

        const vpnUser = fields[0]; 
        const vpnPass = fields[1]; 
        const twoFaEmail = fields[2]; 
        const ingressUser = fields[3]; 
        const ingressPass = fields[4]; 
        const webMailPass = fields[5]; 
        // fields[6] is WebMail_2FA_Pass
        const sipUser = fields[7]; 
        const sipPass = fields[8]; 
        // fields[9] is Shteti (Country)
        const name = fields[10];

        const output = 
`Name: ${name}

----VPN----
User: ${vpnUser}
Pass: ${vpnPass}
2FA e-Mail: ${twoFaEmail}

----Ingress----
User: ${ingressUser}
Pass: ${ingressPass}

----SIP(Xlite)----
User Name: ${sipUser}
Password: ${sipPass}
Soft Phone Domain IP: 172.16.12.8

----WebMail----
2FA e-Mail: ${twoFaEmail}
Password: ${webMailPass}@
WebMail login page: https://sxb1plzcpnl489552.prod.sxb1.secureserver.net:2096/

----Ingress Interview login page----
EMA Server Link: https://d534ema.keyingress.de/
EMA 2FA VPN: emeavpn01.ipsos.com/2fa`;

        return output;
    }

    // 2. ABH data formatting function (5 fields)
    function formatABH(fields) {
        if (fields.length !== 5) {
            return `ERROR: Numri i fushave të ndara me TAB është i pasaktë. Priten saktësisht 5 fusha, u gjetën ${fields.length}.`;
        }

        const name = fields[0];
        const abhUser = fields[1];
        const abhPass = fields[2];
        const iaxExt = fields[3];
        const iaxPass = fields[4];

        const output = 
`Name:  ${name}

--------------------------------------
ABH Login Details
Username:  ${abhUser}
Password:  ${abhPass}
--------------------------------------
IAX Extension:  ${iaxExt}
Password:  ${iaxPass}
ABH Domain: eu.sip.ssl17.net`;
        
        return output;
    }
    
    // Conversion handler function
    function handleConvert() {
        const projectConfig = PROJECTS_CONFIG[currentProject];

        if (!projectConfig || !projectConfig.converter) {
            // Project is inactive, do nothing
            return;
        }

        const inputElement = document.getElementById('dataInput');
        const outputElement = document.getElementById('outputContent');
        const errorElement = document.getElementById('errorMessage');
        const downloadBtn = document.getElementById('downloadBtn');

        const rawInput = inputElement.value;
        
        // Split fields by TAB
        let fields = rawInput.split('\t').map(f => f.trim());
        
        // Remove trailing empty strings if excessive splitting occurred
        if (fields.length > projectConfig.fieldsCount && fields[fields.length - 1] === '') {
            fields.pop();
        }

        if (fields.length !== projectConfig.fieldsCount) {
             errorElement.innerHTML = `Gabim: Duhet të ngjisni saktësisht ${projectConfig.fieldsCount} fusha të ndara me TAB. U gjetën ${fields.length}.`;
             errorElement.style.display = 'block';
             outputElement.innerText = "Error during conversion. Please check input format.";
             downloadBtn.style.display = 'none';
             return;
        }

        // Process conversion
        errorElement.style.display = 'none';
        try {
            const formattedData = projectConfig.converter(fields);
            
            if (formattedData.startsWith("ERROR")) {
                errorElement.innerHTML = formattedData.replace("ERROR: ", "");
                errorElement.style.display = 'block';
                outputElement.innerText = "Error during conversion. Please check input format.";
                downloadBtn.style.display = 'none';
            } else {
                outputElement.innerText = formattedData;
                downloadBtn.style.display = 'inline-flex';
            }

        } catch (e) {
            errorElement.innerHTML = "Një gabim i papritur ndodhi gjatë formatimit: " + e.message;
            errorElement.style.display = 'block';
            outputContent.innerText = "Internal error.";
            downloadBtn.style.display = 'none';
        }
    }

    // Function to download the TXT file
    function downloadTxt() {
        const outputContent = document.getElementById('outputContent').innerText;
        const projectConfig = PROJECTS_CONFIG[currentProject] || { fileNamePrefix: 'formatted_data' };
        
        // Try to extract name for file naming
        const nameMatch = outputContent.match(/Name:\s+(.*)\n/);
        const defaultName = 'formatted_user';
        let baseName = (nameMatch && nameMatch[1].trim()) ? nameMatch[1].trim().replace(/\s+/g, '_') : defaultName;

        const fileName = `${baseName}${projectConfig.fileNamePrefix}.txt`;
        
        const blob = new Blob([outputContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // Sidebar link handler
    function handleProjectSwitch(event) {
        event.preventDefault();
        const targetLink = event.currentTarget;
        const projectId = targetLink.getAttribute('data-project');
        
        const links = document.querySelectorAll('.sidebar a');
        links.forEach(link => link.classList.remove('active'));
        targetLink.classList.add('active');

        currentProject = projectId;
        updateMainContent(projectId);
    }

    // Function to update the main view based on the selected project
    function updateMainContent(projectId) {
        const titleElement = document.getElementById('projectTitle');
        const formatterContainer = document.getElementById('formatterContainer');
        const inactiveMessage = document.getElementById('inactiveMessage');
        const dataInput = document.getElementById('dataInput');
        const helperText = document.getElementById('helperText');
        const outputContent = document.getElementById('outputContent');
        const errorElement = document.getElementById('errorMessage');

        const projectName = document.querySelector(`.sidebar a[data-project="${projectId}"]`).textContent;

        titleElement.innerHTML = `${projectName} Formatter <span id="projectStatus" class="status-badge"></span>`;
        const newStatusBadge = document.getElementById('projectStatus');
        
        const projectConfig = PROJECTS_CONFIG[projectId];
        
        inactiveMessage.textContent = "Ky projekt nuk është aktiv. Konvertimi i të dhënave nuk është i mundur.";


        if (projectConfig && projectConfig.converter) {
            // Project is ACTIVE (Ipsos or ABH)
            newStatusBadge.textContent = 'Aktiv';
            newStatusBadge.classList.remove('status-inactive');
            newStatusBadge.classList.add('status-active');
            
            formatterContainer.style.display = 'block';
            inactiveMessage.style.display = 'none';

            // Update input and helper text
            helperText.textContent = projectConfig.helper;
            dataInput.value = projectConfig.placeholder;
            dataInput.placeholder = "Ngjisni rreshtin e të dhënave këtu...";
            
            outputContent.innerText = "Duke pritur për të dhëna...";
            errorElement.style.display = 'none';
            
            // Convert sample data
            handleConvert();

        } else {
            // Other projects are INACTIVE
            newStatusBadge.textContent = 'Joaktiv';
            newStatusBadge.classList.remove('status-active');
            newStatusBadge.classList.add('status-inactive');
            
            formatterContainer.style.display = 'none';
            inactiveMessage.style.display = 'block';
            
            // Update helper text and placeholder for inactive projects
            helperText.textContent = inactiveMessage.textContent;
            dataInput.value = '';
            dataInput.placeholder = inactiveMessage.textContent;
            outputContent.innerText = ""; // Clear output
        }
    }


    // Dashboard initialization called after successful login
    function initializeDashboard() {
        // Create event listeners for sidebar clicks
        const links = document.querySelectorAll('.sidebar a');
        links.forEach(link => {
            link.removeEventListener('click', handleProjectSwitch); 
            link.addEventListener('click', handleProjectSwitch); 
        });

        // Set ABH as active on initial load
        updateMainContent('abh');
    }

    // Initial authentication check
    document.addEventListener('DOMContentLoaded', () => {
        if (getAuthToken() === 'logged_in_true') {
            showDashboard();
        } else {
            showLogin();
        }
    });

</script>

</body>
</html>
